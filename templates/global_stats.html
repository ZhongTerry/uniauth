{% extends "base.html" %}

{% block content %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<div class="header-row">
    <div>
        <a href="/dashboard" style="text-decoration: none; color: #666; font-size: 14px;">â† è¿”å›ä»ªè¡¨ç›˜</a>
        <h2 style="margin: 5px 0;">ğŸŒ å…¨ç«™æ•°æ®çœ‹æ¿</h2>
        <p style="margin:0; color:#666; font-size:13px;">UniAuth å¹³å°å®æ—¶è¿è¡ŒçŠ¶æ€</p>
    </div>
</div>

<!-- æ ¸å¿ƒæŒ‡æ ‡å¡ç‰‡ (3åˆ—å¸ƒå±€) -->
<div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px;">
    <!-- ç”¨æˆ·æ€»æ•° -->
    <div class="card" style="margin:0; padding: 25px; text-align: center; border-bottom: 4px solid #007bff;">
        <div style="font-size: 36px; font-weight: bold; color: #333;">{{ total_users }}</div>
        <div style="color: #666; font-size: 14px; margin-top: 5px;">ğŸ‘¥ æ³¨å†Œå¼€å‘è€…</div>
    </div>
    
    <!-- åº”ç”¨æ€»æ•° -->
    <div class="card" style="margin:0; padding: 25px; text-align: center; border-bottom: 4px solid #6f42c1;">
        <div style="font-size: 36px; font-weight: bold; color: #333;">{{ total_apps }}</div>
        <div style="color: #666; font-size: 14px; margin-top: 5px;">ğŸš€ æ¥å…¥åº”ç”¨æ•°</div>
    </div>
    
    <!-- è°ƒç”¨æ€»æ•° -->
    <div class="card" style="margin:0; padding: 25px; text-align: center; border-bottom: 4px solid #fd7e14;">
        <div style="font-size: 36px; font-weight: bold; color: #333;">{{ total_calls }}</div>
        <div style="color: #666; font-size: 14px; margin-top: 5px;">âš¡ API æ€»è°ƒç”¨æ¬¡æ•°</div>
    </div>
</div>

<!-- æµé‡è¶‹åŠ¿å›¾ -->
<div class="card" style="margin:0;">
    <h3 style="margin-top:0; border-bottom: 1px solid #eee; padding-bottom: 15px; margin-bottom: 20px;">
        å¹³å°æ´»è·ƒè¶‹åŠ¿ (è¿‘7å¤©)
    </h3>
    
    <!-- [å…³é”®] å›ºå®šé«˜åº¦å®¹å™¨ï¼Œé˜²æ­¢å›¾è¡¨æ— é™æ‹‰ä¼¸ -->
    <div style="position: relative; height: 350px; width: 100%;">
        <canvas id="globalChart"></canvas>
    </div>
</div>

<script>
    const ctx = document.getElementById('globalChart').getContext('2d');
    
    // åˆ›å»ºæ¸å˜è‰²èƒŒæ™¯
    const gradient = ctx.createLinearGradient(0, 0, 0, 400);
    gradient.addColorStop(0, 'rgba(0, 123, 255, 0.3)');
    gradient.addColorStop(1, 'rgba(0, 123, 255, 0)');

    new Chart(ctx, {
        type: 'line',
        data: {
            labels: {{ chart_labels | tojson }},
            datasets: [{
                label: 'å…¨ç«™ API ååé‡',
                data: {{ chart_data | tojson }},
                borderColor: '#007bff',
                backgroundColor: gradient,
                borderWidth: 3,
                pointBackgroundColor: '#fff',
                pointBorderColor: '#007bff',
                pointRadius: 5,
                fill: true,
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false, // é…åˆå¤–å±‚ div å®ç°è‡ªé€‚åº”
            plugins: {
                legend: { display: false }
            },
            scales: {
                y: { 
                    beginAtZero: true, 
                    grid: { borderDash: [5, 5] },
                    ticks: { precision: 0 } 
                },
                x: { grid: { display: false } }
            }
        }
    });
</script>
{% endblock %}