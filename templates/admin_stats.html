{% extends "base.html" %}

{% block content %}
<!-- å¼•å…¥ Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<div class="header-row">
    <div>
        <!-- ä¿®å¤ç‚¹ï¼šè¿™é‡Œæ˜¯è¿”å›ä»ªè¡¨ç›˜ï¼Œä¸èƒ½ç”¨ app.client_id -->
        <a href="/dashboard" style="text-decoration: none; color: #666; font-size: 14px;">â† è¿”å›ä»ªè¡¨ç›˜</a>
        <h2 style="margin: 5px 0;">ğŸ›¡ï¸ ç®¡ç†å‘˜ç»Ÿè®¡é¢æ¿</h2>
        <p style="margin:0; color:#666; font-size:13px;">å…¨ç«™æ•°æ®ç›‘æ§ä¸åˆ†æ</p>
    </div>
    <div style="display:flex; align-items:center; gap:10px;">
        <span style="background: #28a745; color: white; padding: 4px 10px; border-radius: 20px; font-size: 12px; font-weight: bold;">Admin</span>
    </div>
</div>

<!-- æ ¸å¿ƒæŒ‡æ ‡å¡ç‰‡ -->
<div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px;">
    <div class="card" style="margin:0; padding: 25px; text-align: center;">
        <div style="font-size: 32px; font-weight: bold; color: #333;">{{ total_users }}</div>
        <div style="color: #666; font-size: 13px; margin-top: 5px;">ğŸ‘¥ æ€»ç”¨æˆ·æ•°</div>
    </div>
    <div class="card" style="margin:0; padding: 25px; text-align: center;">
        <div style="font-size: 32px; font-weight: bold; color: #6f42c1;">{{ total_apps }}</div>
        <div style="color: #666; font-size: 13px; margin-top: 5px;">ğŸš€ æ€»åº”ç”¨æ•°</div>
    </div>
    <div class="card" style="margin:0; padding: 25px; text-align: center;">
        <div style="font-size: 32px; font-weight: bold; color: #007bff;">{{ today_calls }}</div>
        <div style="color: #666; font-size: 13px; margin-top: 5px;">ğŸ“ˆ ä»Šæ—¥ API è°ƒç”¨</div>
    </div>
    <div class="card" style="margin:0; padding: 25px; text-align: center;">
        <div style="font-size: 32px; font-weight: bold; color: #fd7e14;">{{ total_calls }}</div>
        <div style="color: #666; font-size: 13px; margin-top: 5px;">ğŸ“š å†å²æ€»è°ƒç”¨</div>
    </div>
</div>

<div style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px;">
    <!-- å›¾è¡¨åŒºåŸŸ -->
    <div class="card" style="margin:0; min-height: 300px;">
        <h3 style="margin-top:0; margin-bottom: 20px;">ğŸ“Š API æµé‡è¶‹åŠ¿ (è¿‘7å¤©)</h3>
        <canvas id="trafficChart"></canvas>
    </div>

    <!-- æœ€è¿‘æ³¨å†Œç”¨æˆ· -->
    <div class="card" style="margin:0;">
        <h3 style="margin-top:0; margin-bottom: 15px;">ğŸ†• æœ€æ–°ç”¨æˆ·</h3>
        <!-- åœ¨ admin_stats.html æ›¿æ¢å¯¹åº”çš„ a æ ‡ç­¾åŒºåŸŸ -->
<div class="card" style="margin: 0; padding: 20px;display: flex; justify-content: space-between; align-items: center; border: none; margin-bottom: 20px;">
    <!-- <div>
        <h4 style="margin: 0; font-size: 16px;">é‚€è¯·æ³¨å†Œç³»ç»Ÿ</h4>
        <p style="margin: 5px 0 0 0; font-size: 12px; color: #94a3b8;">ç®¡ç†æ— éœ€é‚®ç®±éªŒè¯çš„ç‰¹æƒæ³¨å†Œç </p> -->
    <!-- </div> -->
    <a href="/admin/invites" class="p-btn">
        è¿›å…¥ç®¡ç†
    </a>
</div>
        <ul style="list-style: none; padding: 0; margin: 0;">
            {% for u in recent_users %}
            <li style="display: flex; align-items: center; gap: 10px; padding: 10px 0; border-bottom: 1px solid #eee;">
                <img src="{{ u.avatar }}" style="width: 30px; height: 30px; border-radius: 50%;">
                <div style="flex: 1; overflow: hidden;">
                    <div style="font-weight: 500; font-size: 14px;">{{ u.username }}</div>
                    <div style="font-size: 11px; color: #999;">ID: {{ u.id }}</div>
                </div>
                {% if u.is_admin %}
                <span style="font-size: 10px; background: #e9ecef; color: #333; padding: 2px 6px; border-radius: 4px;">Admin</span>
                {% endif %}
            </li>
            {% endfor %}
        </ul>
    </div>
</div>

<script>
    // åˆå§‹åŒ–å›¾è¡¨
    const ctx = document.getElementById('trafficChart').getContext('2d');
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: {{ chart_labels | tojson }},
            datasets: [{
                label: 'API è°ƒç”¨æ¬¡æ•°',
                data: {{ chart_data | tojson }},
                borderColor: '#007bff',
                backgroundColor: 'rgba(0, 123, 255, 0.1)',
                borderWidth: 2,
                fill: true,
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { display: false }
            },
            scales: {
                y: { beginAtZero: true, grid: { borderDash: [5, 5] } },
                x: { grid: { display: false } }
            }
        }
    });
</script>
{% endblock %}